package core

import (
	artiModel "github.com/goharbor/harbor/src/pkg/artifact"
	projModel "github.com/goharbor/harbor/src/pkg/project/models"
	repoModel "github.com/goharbor/harbor/src/pkg/repository/model"
	"time"
)

type FindArgs struct {
	Credentials       *HarborCredentials
	HarborURL         string
	PackageExpression string
	OnlyProjects      []string
}

type HarborCredentials struct {
	Username string
	Password string
}

type RepoSummary struct {
	RepoName             string
	VulnerabilitiesTotal int64
}

type ProjectSummary struct {
	ProjectName          string
	VulnerabilitiesTotal int64
	RepoSummaries        []RepoSummary
}

type HarborArtifact struct {
	artiModel.Artifact `json:",inline"`
}

type HarborRepository struct {
	repoModel.RepoRecord `json:",inline"`
}

type HarborProject struct {
	projModel.Project `json:",inline"`
}

type Tag struct {
	ID           int64     `orm:"pk;auto;column(id)" json:"id"`
	RepositoryID int64     `orm:"column(repository_id)" json:"repository_id"` // tags are the resources of repository, one repository only contains one same name tag
	ArtifactID   int64     `orm:"column(artifact_id)" json:"artifact_id"`     // the artifact ID that the tag attaches to, it changes when pushing a same name but different digest artifact
	Name         string    `orm:"column(name)" json:"name"`
	PushTime     time.Time `orm:"column(push_time)" json:"push_time"`
	PullTime     time.Time `orm:"column(pull_time)" json:"pull_time"`
	// not included in json but added by service
	ArtifactDigest string
}

type CveReport struct {
	ApplicationVndSecurityVulnerabilityReportVersion11 struct {
		GeneratedAt time.Time `json:"generated_at"`
		Scanner     struct {
			Name    string `json:"name"`
			Vendor  string `json:"vendor"`
			Version string `json:"version"`
		} `json:"scanner"`
		Severity        string `json:"severity"`
		Vulnerabilities []struct {
			ID              string   `json:"id"`
			Package         string   `json:"package"`
			Version         string   `json:"version"`
			FixVersion      string   `json:"fix_version"`
			Severity        string   `json:"severity"`
			Description     string   `json:"description"`
			Links           []string `json:"links"`
			ArtifactDigests []string `json:"artifact_digests"`
			PreferredCvss   struct {
				ScoreV3  any    `json:"score_v3"`
				ScoreV2  any    `json:"score_v2"`
				VectorV3 string `json:"vector_v3"`
				VectorV2 string `json:"vector_v2"`
			} `json:"preferred_cvss"`
			CweIds           []string `json:"cwe_ids"`
			VendorAttributes struct {
				Cvss struct {
					Nvd struct {
						V2Score  float64 `json:"V2Score"`
						V2Vector string  `json:"V2Vector"`
						V3Score  float64 `json:"V3Score"`
						V3Vector string  `json:"V3Vector"`
					} `json:"nvd"`
					Redhat struct {
						V3Score  float64 `json:"V3Score"`
						V3Vector string  `json:"V3Vector"`
					} `json:"redhat"`
				} `json:"CVSS"`
			} `json:"vendor_attributes"`
		} `json:"vulnerabilities"`
	} `json:"application/vnd.security.vulnerability.report; version=1.1"`
}
